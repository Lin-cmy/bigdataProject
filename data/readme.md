# Bç«™ç•ªå‰§å¼¹å¹•æ•°æ®é›†

  æœ¬æ•°æ®é›†åŒ…å«ä» Bilibili çƒ­é—¨ç•ªå‰§ã€Šé—´è°è¿‡å®¶å®¶ã€‹å’Œã€Šå‡¡äººä¿®ä»™ä¼ ã€‹é‡‡é›†çš„å¼¹å¹•æ•°æ®ã€‚æ•°æ®å·²è¿›è¡Œæ¸…æ´—å’Œç»“æ„åŒ–å¤„ç†ï¼Œå¹¶åŒ…å«åŸºäº Spark è®¡ç®—çš„è¯é¢‘ç»Ÿè®¡ç»“æœï¼Œå¯ä»¥ç”¨äº NLP æƒ…æ„Ÿåˆ†æã€ç”¨æˆ·è¡Œä¸ºæŒ–æ˜ã€ç¤¾äº¤ç½‘ç»œæ„å»ºåŠé«˜èƒ½æ—¶åˆ»æ£€æµ‹ç­‰å¤§æ•°æ®ä»»åŠ¡ã€‚

---

## ğŸ“‚ æ•°æ®é›†æ¦‚è§ˆ (Overview)

- **æ•°æ®æ¥æº**: Bilibili Video (BV) æ¥å£
- **é‡‡é›†æ–¹å¼**: åˆ†å¸ƒå¼çˆ¬è™« (åŸºäº Protobuf é€†å‘)
- **æ•°æ®æ€»é‡**: è¶…500ä¸‡æ¡
- **å­˜å‚¨æ ¼å¼**: CSV (UTF-8 ç¼–ç )

---

## ğŸ“ æ•°æ®ç»“æ„è¯´æ˜ (Data Schema)

æœ¬æ•°æ®é›†ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ç±»æ–‡ä»¶ï¼š

### 1. åŸå§‹å¼¹å¹•æ•°æ®
**æ–‡ä»¶å‘½åè§„åˆ™**: `danmaku_{BVID}.csv` (ä¾‹å¦‚ `danmaku_BV1raFSeNEeB.csv`)

| å­—æ®µå (Field) | ç±»å‹ (Type) | è¯´æ˜ (Description)                             | ç¤ºä¾‹ (Example)        |
| :------------- | :---------- | :--------------------------------------------- | :-------------------- |
| **dmid**       | `String`    | å¼¹å¹•å”¯ä¸€æ ‡è¯† IDï¼Œå¯ç”¨äºå»é‡                    | `1782555842080989696` |
| **video_time** | `Float`     | å¼¹å¹•åœ¨è§†é¢‘ä¸­å‡ºç°çš„æ—¶é—´ç‚¹ (ç§’)                  | `129.545`             |
| **text**       | `String`    | å¼¹å¹•æ–‡æœ¬å†…å®¹                                   | `å“‡åº“å“‡åº“`            |
| **send_date**  | `Datetime`  | å¼¹å¹•å‘é€çš„å…·ä½“æ—¥æœŸæ—¶é—´                         | `2025-02-15 11:00:15` |
| **uid**        | `String`    | ç”¨æˆ· ID (Hash è„±æ•)ï¼Œç”¨äºè¯†åˆ«åŒä¸€ç”¨æˆ·          | `94c89b97`            |
| **source**     | `String`    | æ•°æ®æ¥æºæ ‡è®° (api:å®æ—¶æ¥å£ / history:å†å²æ¥å£) | `api`                 |

---

## ğŸ” æ•°æ®æ ·æœ¬é¢„è§ˆ (Data Preview)

### å¼¹å¹•æ ·æœ¬ (Sample Rows)
> æ¥æºæ–‡ä»¶: `danmaku_BV1raFSeNEeB.csv`

```csv
dmid,video_time,text,send_date,uid,source
1782555842080989696,129.545,å‘€å‘¼,2025-02-15 11:00:15,94c89b97,api
1782555857558149120,128.777,å¿µå¤´é€šè¾¾ï¼,2025-02-15 11:00:17,52412bb3,api
1782555866869497344,128.0,ç¬¬ä¸€å—ï¼Ÿæœ‰ç‚¹æ„æ€,2025-02-15 11:00:18,131098b6,api
```



---

## ğŸ› ï¸ å¦‚ä½•ä½¿ç”¨ (Usage)

### åœºæ™¯ 1: ä½¿ç”¨ Pandas è¯»å– (Python å•æœº)

Python

```
import pandas as pd

# è¯»å–åŸå§‹æ•°æ®
df = pd.read_csv("danmaku_BV1raFSeNEeB.csv")

# æŸ¥çœ‹å‰ 5 è¡Œ
print(df.head())

# ç®€å•ç»Ÿè®¡ï¼šæŸ¥çœ‹å‘é€å¼¹å¹•æœ€å¤šçš„ç”¨æˆ·
top_users = df['uid'].value_counts().head(10)
print(top_users)
```

### åœºæ™¯ 2: ä½¿ç”¨ Spark è¯»å– (åˆ†å¸ƒå¼é›†ç¾¤)

Python

```
from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("DanmakuAnalysis") \
    .getOrCreate()

# è¯»å– HDFS ä¸Šçš„æ•°æ®
df = spark.read.csv("hdfs:///bilibili/dataset/raw/*.csv", header=True, inferSchema=True)

# æ³¨å†Œä¸ºä¸´æ—¶è¡¨
df.createOrReplaceTempView("danmaku")

# SQL æŸ¥è¯¢ï¼šæ¯åˆ†é’Ÿå¼¹å¹•å¯†åº¦
spark.sql("""
    SELECT floor(video_time/60) as minute, count(*) as count 
    FROM danmaku 
    GROUP BY minute 
    ORDER BY minute
""").show()
```

------

## âš ï¸ ç‰ˆæƒè¯´æ˜ (License)

æœ¬æ•°æ®é›†ä»…ä¾›å­¦æœ¯ç ”ç©¶ä¸æ•™è‚²ç”¨é€”ä½¿ç”¨ã€‚ æ•°æ®æ‰€æœ‰æƒå½’ Bilibili åŠåŸè§†é¢‘åˆ›ä½œè€…æ‰€æœ‰ã€‚è¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚